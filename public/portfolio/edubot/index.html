<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/portfolio/edubot/">
    <title>EduBot - AI Curriculum Assistant</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px; margin: 0 auto; padding: 20px;
            background: #e2e8f0; color: #334155;
        }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { color: #1e293b; margin-bottom: 8px; }
        .subtitle { color: #64748b; margin-bottom: 30px; }
        .book-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .book-card { 
            border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px; cursor: pointer; 
            transition: all 0.2s; display: flex; gap: 15px; align-items: start;
        }
        .book-card:hover { border-color: #3b82f6; box-shadow: 0 4px 6px -1px rgba(59,130,246,0.2); }
        .book-card.selected { border-color: #3b82f6; background: #eff6ff; }
        .book-cover { width: 80px; height: 110px; object-fit: cover; border-radius: 4px; }
        .book-info { flex: 1; }
        .book-title { font-weight: 600; color: #1e293b; margin-bottom: 4px; }
        .book-author { font-size: 14px; color: #64748b; margin-bottom: 8px; }
        .book-subjects { display: flex; gap: 4px; flex-wrap: wrap; }
        .subject-tag { background: #e2e8f0; padding: 2px 8px; border-radius: 4px; font-size: 12px; color: #475569; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        textarea { 
            width: 100%; padding: 12px; border: 2px solid #e2e8f0; 
            border-radius: 8px; font-size: 16px; font-family: inherit;
        }
        textarea:focus { 
            outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
        }
        button { 
            background: #3b82f6; color: white; border: none; padding: 12px 24px;
            border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: 500;
        }
        button:hover { background: #2563eb; }
        button:disabled { background: #94a3b8; cursor: not-allowed; }
        .response { 
            margin-top: 20px; padding: 20px; background: #f1f5f9; 
            border-radius: 8px; border-left: 4px solid #3b82f6;
        }
        .error { border-left-color: #ef4444; background: #fef2f2; }
        .loading { text-align: center; color: #64748b; }
        .sources { margin-top: 15px; font-size: 14px; color: #64748b; }
        .source { background: #e2e8f0; padding: 4px 8px; border-radius: 4px; margin: 2px; display: inline-block; }
        .current-book { 
            background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;
            display: flex; align-items: center; gap: 15px; border: 2px solid #3b82f6;
        }
        .current-book-cover { width: 60px; height: 80px; object-fit: cover; border-radius: 4px; }
        .current-book-info h3 { margin: 0 0 4px 0; color: #1e293b; }
        .current-book-info p { margin: 0; font-size: 14px; color: #64748b; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; gap: 30px; align-items: center; margin-bottom: 30px;">
            <img src="logo.png" alt="EduBot" style="width: 200px; height: auto; flex-shrink: 0;">
            <div style="flex: 1;">
                <h1 style="margin: 0 0 5px 0;">EduBot</h1>
                <p style="margin: 0; color: #64748b; font-size: 18px;">AI Tutor for Your Curriculum</p>
            </div>
        </div>
        
        <details style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 30px; border-left: 4px solid #3b82f6; cursor: pointer;">
            <summary style="font-weight: 600; color: #1e293b; font-size: 16px; list-style: none; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 20px;">‚ñ∂</span> Why EduBot? (Click to expand)
            </summary>
            <div style="margin-top: 15px;">
                <h3 style="margin-top: 0; color: #1e293b;">Answers from YOUR textbooks only. Nothing else.</h3>
                <p style="margin-bottom: 15px; color: #475569;">Unlike ChatGPT or other AI tools that pull from the entire internet, EduBot only uses your school's approved curriculum. Every answer comes directly from the textbooks your teachers assigned‚Äîensuring you're studying the right material for your exams.</p>
                
                <h4 style="color: #1e293b; margin-bottom: 10px;">Why This Matters</h4>
                <ul style="color: #475569; margin: 0 0 15px 20px;">
                    <li><strong>No Off-Topic Information</strong>: Only content from your actual course materials</li>
                    <li><strong>Exam-Aligned</strong>: Study what your teachers are testing you on</li>
                    <li><strong>Trustworthy Sources</strong>: Every answer cites the exact textbook sections used</li>
                    <li><strong>School-Approved Content</strong>: Your institution controls what books are available</li>
                </ul>
                
                <p style="margin: 0; color: #475569; font-size: 14px;">Available 24/7, no office hours needed. Ask as many questions as you want.</p>
            </div>
        </details>
        
        <style>
            details[open] summary span { transform: rotate(90deg); display: inline-block; }
            summary::-webkit-details-marker { display: none; }
        </style>
        
        <h2>Select a Book:</h2>
        <div class="book-selector" id="bookSelector"></div>
        
        <div id="currentBook" style="display: none;"></div>
        
        <div class="input-group">
            <label for="question">Your Question:</label>
            <textarea id="question" rows="3" placeholder="What is philosophy? How does Aristotle define virtue? What are the main branches of ethics?"></textarea>
        </div>
        
        <button onclick="askQuestion()" id="askBtn">Ask EduBot</button>
        
        <div id="response" style="display: none;"></div>
    </div>

    <script>
        const API_URL = 'https://xbo335usp3gx5cklup5w3gtsky0iykgt.lambda-url.us-east-1.on.aws';
        let books = [];
        let selectedBook = null;
        
        async function loadBooks() {
            try {
                const response = await fetch('books.json');
                const data = await response.json();
                books = data.books;
                renderBooks();
                if (books.length > 0) {
                    selectBook(books[0]);
                }
            } catch (error) {
                console.error('Failed to load books:', error);
            }
        }
        
        function renderBooks() {
            const selector = document.getElementById('bookSelector');
            selector.innerHTML = books.map((book, index) => `
                <div class="book-card" data-book-index="${index}" onclick="selectBookByIndex(${index})">
                    <img src="${book.cover}" alt="${book.title}" class="book-cover" onerror="this.src='https://via.placeholder.com/80x110/4A90E2/ffffff?text=Book'">
                    <div class="book-info">
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">${book.author}</div>
                        <div class="book-subjects">
                            ${book.subjects.map(s => `<span class="subject-tag">${s}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function selectBookByIndex(index) {
            selectBook(books[index]);
        }
        
        function selectBook(book) {
            selectedBook = book;
            document.querySelectorAll('.book-card').forEach(card => card.classList.remove('selected'));
            event?.target?.closest('.book-card')?.classList.add('selected');
            
            const currentBookDiv = document.getElementById('currentBook');
            currentBookDiv.style.display = 'block';
            currentBookDiv.innerHTML = `
                <div class="current-book">
                    <img src="${book.cover}" alt="${book.title}" class="current-book-cover" onerror="this.src='https://via.placeholder.com/60x80/4A90E2/ffffff?text=Book'">
                    <div class="current-book-info">
                        <h3>Currently Using: ${book.title}</h3>
                        <p>by ${book.author} ‚Ä¢ ${book.publisher}</p>
                        <p style="margin-top: 8px; font-size: 13px;">${book.description}</p>
                    </div>
                </div>
            `;
        }
        
        async function askQuestion() {
            if (!selectedBook) {
                alert('Please select a book first');
                return;
            }
            
            const question = document.getElementById('question').value.trim();
            const responseDiv = document.getElementById('response');
            const askBtn = document.getElementById('askBtn');
            
            if (!question) {
                alert('Please enter a question');
                return;
            }
            
            askBtn.disabled = true;
            askBtn.textContent = 'Thinking...';
            responseDiv.style.display = 'block';
            responseDiv.className = 'response loading';
            responseDiv.innerHTML = 'ü§î Searching ' + selectedBook.title + ' and generating answer...';
            
            try {
                const response = await fetch(`${API_URL}/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, book_id: selectedBook.id })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    responseDiv.className = 'response';
                    responseDiv.innerHTML = `
                        <h3>Answer from ${selectedBook.title}:</h3>
                        <p>${data.answer}</p>
                        <div class="sources">
                            <strong>Sources:</strong> 
                            ${data.sources.map(s => `<span class="source">${s.s3_key.split('/').pop().replace('.json', '')}</span>`).join('')}
                            <br><small>Response time: ${data.duration_ms}ms</small>
                        </div>
                    `;
                } else {
                    throw new Error(data.error || 'Unknown error');
                }
            } catch (error) {
                responseDiv.className = 'response error';
                responseDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            } finally {
                askBtn.disabled = false;
                askBtn.textContent = 'Ask EduBot';
            }
        }
        
        document.getElementById('question').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                askQuestion();
            }
        });
        
        window.onload = async function() {
            await loadBooks();
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                if (data.ok) {
                    console.log('‚úÖ EduBot API connected');
                }
            } catch (error) {
                console.log('‚ùå EduBot API connection failed:', error);
            }
        };
    </script>
</body>
</html>